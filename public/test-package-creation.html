<!DOCTYPE html>
<html>
<head>
    <title>Test Travel Package Creation</title>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .step { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #b8daff; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .form-group { margin: 10px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, textarea, select { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        .result { margin-top: 20px; padding: 15px; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ Test Travel Package Creation</h1>
        
        <div class="step info">
            <h3>üìã Instructions:</h3>
            <ol>
                <li>First, login as admin by clicking "Go to Login"</li>
                <li>Use admin credentials: admin@solva.com / admin123</li>
                <li>Come back to this page and test package creation</li>
                <li>Or use the quick test with sample data</li>
            </ol>
        </div>

        <div class="step">
            <h3>üîó Quick Actions:</h3>
            <button onclick="goToMain()">Go to Main Site</button>
            <button onclick="goToManagement()">Go to Management</button>
            <button onclick="testQuickLogin()">Quick Admin Login Test</button>
        </div>

        <div class="step">
            <h3>üß™ Test Package Creation with Sample Data:</h3>
            <button onclick="testCreateSamplePackage()">Create Sample Package</button>
            <button onclick="testGetPackages()">Get All Packages</button>
            <button onclick="checkAuth()">Check Auth Status</button>
        </div>

        <div class="step">
            <h3>üìù Manual Package Creation:</h3>
            <form id="packageForm">
                <div class="form-group">
                    <label>Package Name:</label>
                    <input type="text" id="name" value="‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à Chiang Mai" required>
                </div>
                <div class="form-group">
                    <label>Description:</label>
                    <textarea id="description" rows="3" required>‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™‡∏Ñ‡∏ß‡∏≤‡∏°‡∏á‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà ‡∏î‡∏≠‡∏¢‡∏™‡∏∏‡πÄ‡∏ó‡∏û ‡∏ß‡∏±‡∏î‡πÅ‡∏™‡∏á‡πÅ‡∏Å‡πâ‡∏ß ‡πÅ‡∏•‡∏∞‡∏ß‡∏±‡∏ü‡∏ò‡∏£‡∏£‡∏°‡∏•‡πâ‡∏≤‡∏ô‡∏ô‡∏≤</textarea>
                </div>
                <div class="form-group">
                    <label>Location:</label>
                    <input type="text" id="location" value="‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà" required>
                </div>
                <div class="form-group">
                    <label>Duration (Days):</label>
                    <input type="number" id="durationDays" value="3" required>
                </div>
                <div class="form-group">
                    <label>Price (THB):</label>
                    <input type="number" id="priceNumber" value="8500" required>
                </div>
                <div class="form-group">
                    <label>Max Capacity:</label>
                    <input type="number" id="maxCapacity" value="15" required>
                </div>
                <button type="button" onclick="createCustomPackage()">Create This Package</button>
            </form>
        </div>

        <div id="result" class="result" style="display: none;"></div>
    </div>

    <script>
        // Utility functions
        function showResult(message, type = 'info') {
            const result = document.getElementById('result');
            result.className = `result ${type}`;
            result.innerHTML = message;
            result.style.display = 'block';
            console.log(message);
        }

        function goToMain() {
            window.open('http://localhost:3001', '_blank');
        }

        function goToManagement() {
            window.open('http://localhost:3001/management', '_blank');
        }

        async function testQuickLogin() {
            try {
                const response = await fetch('http://localhost:3001/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: 'admin@solva.com',
                        password: 'admin123'
                    })
                });

                const data = await response.json();
                
                if (response.ok && data.token) {
                    localStorage.setItem('token', data.token);
                    localStorage.setItem('user', JSON.stringify(data.user));
                    showResult(`‚úÖ Login Successful!<br>Token: ${data.token.substring(0, 20)}...<br>User: ${data.user.firstName} ${data.user.lastName} (${data.user.role})`, 'success');
                } else {
                    showResult(`‚ùå Login Failed: ${data.message || 'Unknown error'}`, 'error');
                }
            } catch (error) {
                showResult(`‚ùå Login Error: ${error.message}`, 'error');
            }
        }

        async function checkAuth() {
            const token = localStorage.getItem('token');
            const user = localStorage.getItem('user');
            
            if (token && user) {
                const userData = JSON.parse(user);
                showResult(`‚úÖ Logged in as: ${userData.firstName} ${userData.lastName}<br>Role: ${userData.role}<br>Token exists: Yes`, 'success');
            } else {
                showResult(`‚ùå Not logged in. Please login first.`, 'error');
            }
        }

        async function testGetPackages() {
            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    showResult('‚ùå No token found. Please login first.', 'error');
                    return;
                }

                const response = await fetch('http://localhost:3001/api/management/packages', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await response.json();
                
                if (response.ok) {
                    showResult(`‚úÖ Packages Retrieved:<br>Total: ${data.total}<br>Count: ${data.data.length}<br><pre>${JSON.stringify(data.data.slice(0, 2), null, 2)}</pre>`, 'success');
                } else {
                    showResult(`‚ùå Failed to get packages: ${data.message}`, 'error');
                }
            } catch (error) {
                showResult(`‚ùå Error getting packages: ${error.message}`, 'error');
            }
        }

        async function testCreateSamplePackage() {
            const samplePackage = {
                name: "‡∏ó‡∏±‡∏ß‡∏£‡πå‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà 3 ‡∏ß‡∏±‡∏ô 2 ‡∏Ñ‡∏∑‡∏ô - ‡∏ó‡∏î‡∏™‡∏≠‡∏ö",
                title: "‡∏ó‡∏±‡∏ß‡∏£‡πå‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà 3 ‡∏ß‡∏±‡∏ô 2 ‡∏Ñ‡∏∑‡∏ô",
                description: "‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™‡∏Ñ‡∏ß‡∏≤‡∏°‡∏á‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏î‡∏≠‡∏¢‡∏™‡∏∏‡πÄ‡∏ó‡∏û ‡∏ß‡∏±‡∏î‡πÅ‡∏™‡∏á‡πÅ‡∏Å‡πâ‡∏ß ‡πÅ‡∏•‡∏∞‡∏ï‡∏•‡∏≤‡∏î‡∏ß‡∏±‡∏ô‡πÄ‡∏™‡∏≤‡∏£‡πå ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Ç‡∏±‡∏ô‡πÇ‡∏ï‡∏Å‡∏Ç‡πâ‡∏≤‡∏ß‡∏´‡∏•‡∏≤‡∏°",
                overview: "‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏£‡∏ö‡∏Ñ‡∏£‡∏±‡∏ô ‡∏ä‡∏°‡∏ß‡∏±‡∏í‡∏ô‡∏ò‡∏£‡∏£‡∏°‡∏•‡πâ‡∏≤‡∏ô‡∏ô‡∏≤",
                location: "‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà",
                destination: "‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà ‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏¥‡∏°‡∏ì‡∏ë‡∏•",
                category: "Cultural",
                difficulty: "Easy",
                durationDays: 3,
                durationText: "3 ‡∏ß‡∏±‡∏ô 2 ‡∏Ñ‡∏∑‡∏ô",
                maxCapacity: 15,
                priceNumber: 8500,
                highlights: ["‡∏î‡∏≠‡∏¢‡∏™‡∏∏‡πÄ‡∏ó‡∏û-‡∏õ‡∏∏‡∏¢", "‡∏ß‡∏±‡∏î‡πÅ‡∏™‡∏á‡πÅ‡∏Å‡πâ‡∏ß", "‡∏ï‡∏•‡∏≤‡∏î‡∏ß‡∏±‡∏ô‡πÄ‡∏™‡∏≤‡∏£‡πå", "‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏Ç‡∏±‡∏ô‡πÇ‡∏ï‡∏Å"],
                includes: ["‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏Å 2 ‡∏Ñ‡∏∑‡∏ô", "‡∏≠‡∏≤‡∏´‡∏≤‡∏£ 6 ‡∏°‡∏∑‡πâ‡∏≠", "‡∏£‡∏ñ‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á", "‡πÑ‡∏Å‡∏î‡πå‡∏ó‡πâ‡∏≠‡∏á‡∏ñ‡∏¥‡πà‡∏ô"],
                excludes: ["‡∏ï‡∏±‡πã‡∏ß‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ö‡∏¥‡∏ô", "‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß", "‡∏ó‡∏¥‡∏õ‡πÑ‡∏Å‡∏î‡πå"],
                tags: ["‡∏ß‡∏±‡∏í‡∏ô‡∏ò‡∏£‡∏£‡∏°", "‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå", "‡∏≠‡∏≤‡∏´‡∏≤‡∏£", "‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥"],
                images: ["https://example.com/chiangmai1.jpg", "https://example.com/chiangmai2.jpg"],
                imageUrl: "https://example.com/chiangmai-main.jpg",
                accommodation: {
                    hotel_name: "‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°‡πÄ‡∏î ‡∏ß‡∏¥‡∏á ‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà",
                    room_type: "Superior Room",
                    rating: 4.2,
                    amenities: ["WiFi", "Breakfast", "Pool"]
                },
                itinerary: {
                    day1: {
                        title: "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 1 - ‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏ñ‡∏∂‡∏á‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà",
                        activities: ["‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô", "‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏¥‡∏ô‡πÇ‡∏£‡∏á‡πÅ‡∏£‡∏°", "‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ä‡∏°‡∏ß‡∏±‡∏î‡πÅ‡∏™‡∏á‡πÅ‡∏Å‡πâ‡∏ß", "‡∏ó‡∏≤‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏¢‡πá‡∏ô‡∏£‡∏¥‡∏°‡∏õ‡∏¥‡∏á"]
                    },
                    day2: {
                        title: "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 2 - ‡∏î‡∏≠‡∏¢‡∏™‡∏∏‡πÄ‡∏ó‡∏û‡πÅ‡∏•‡∏∞‡∏ï‡∏•‡∏≤‡∏î‡∏ß‡∏±‡∏ô‡πÄ‡∏™‡∏≤‡∏£‡πå",
                        activities: ["‡∏Ç‡∏∂‡πâ‡∏ô‡∏î‡∏≠‡∏¢‡∏™‡∏∏‡πÄ‡∏ó‡∏û-‡∏õ‡∏∏‡∏¢", "‡∏ó‡∏≤‡∏ô‡∏Ç‡∏±‡∏ô‡πÇ‡∏ï‡∏Å‡∏Ç‡πâ‡∏≤‡∏ß‡∏´‡∏•‡∏≤‡∏°", "‡∏ï‡∏•‡∏≤‡∏î‡∏ß‡∏±‡∏ô‡πÄ‡∏™‡∏≤‡∏£‡πå", "‡∏ô‡∏ß‡∏î‡πÅ‡∏ú‡∏ô‡πÑ‡∏ó‡∏¢"]
                    },
                    day3: {
                        title: "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 3 - ‡∏ä‡πâ‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏•‡∏±‡∏ö",
                        activities: ["‡∏ä‡πâ‡∏≠‡∏õ‡∏õ‡∏¥‡πâ‡∏á‡∏Ç‡∏≠‡∏á‡∏ù‡∏≤‡∏Å", "‡πÄ‡∏ä‡πá‡∏Ñ‡πÄ‡∏≠‡∏≤‡∏ï‡πå", "‡∏™‡πà‡∏á‡∏™‡∏ô‡∏≤‡∏°‡∏ö‡∏¥‡∏ô"]
                    }
                },
                isRecommended: true,
                isActive: true,
                rating: 4.8,
                totalReviews: 0
            };

            await createPackage(samplePackage);
        }

        async function createCustomPackage() {
            const packageData = {
                name: document.getElementById('name').value,
                title: document.getElementById('name').value,
                description: document.getElementById('description').value,
                location: document.getElementById('location').value,
                destination: document.getElementById('location').value,
                durationDays: parseInt(document.getElementById('durationDays').value),
                priceNumber: parseFloat(document.getElementById('priceNumber').value),
                maxCapacity: parseInt(document.getElementById('maxCapacity').value),
                category: "Cultural",
                difficulty: "Easy",
                durationText: `${document.getElementById('durationDays').value} ‡∏ß‡∏±‡∏ô`,
                highlights: ["‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô 1", "‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏à‡∏∏‡∏î‡πÄ‡∏î‡πà‡∏ô 2"],
                includes: ["‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏ß‡∏° 1", "‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏ß‡∏° 2"],
                excludes: ["‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏£‡∏ß‡∏° 1"],
                tags: ["‡∏ó‡∏î‡∏™‡∏≠‡∏ö", "‡πÅ‡∏û‡πá‡∏Å‡πÄ‡∏Å‡∏à"],
                isRecommended: false,
                isActive: true,
                rating: 4.5,
                totalReviews: 0
            };

            await createPackage(packageData);
        }

        async function createPackage(packageData) {
            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    showResult('‚ùå No token found. Please login first.', 'error');
                    return;
                }

                showResult('üîÑ Creating package...', 'info');

                const response = await fetch('http://localhost:3001/api/management/packages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(packageData)
                });

                const result = await response.json();
                
                if (response.ok) {
                    showResult(`‚úÖ Package Created Successfully!<br><strong>ID:</strong> ${result.data.id}<br><strong>Name:</strong> ${result.data.name}<br><strong>Price:</strong> ‡∏ø${result.data.price}<br><strong>Duration:</strong> ${result.data.duration} days<br><pre>${JSON.stringify(result.data, null, 2)}</pre>`, 'success');
                } else {
                    showResult(`‚ùå Failed to create package:<br><strong>Status:</strong> ${response.status}<br><strong>Error:</strong> ${result.message}<br><pre>${JSON.stringify(result, null, 2)}</pre>`, 'error');
                }
            } catch (error) {
                showResult(`‚ùå Error creating package: ${error.message}`, 'error');
            }
        }

        // Auto-check auth on page load
        window.onload = function() {
            checkAuth();
        };
    </script>
</body>
</html>
